@inject IApiLogic _apiLogic;
@inject NavigationManager _navigationManager;
@using Api.Dtos;

@code{
    string pfpSource {get; set;} = "Resources/EmptyPFP.png";
    int userId {get; set;} = 1;
    string username {get; set;} = "luna";
    string postCount {get; set;} = "5";
    MarkupString BIO {get; set;} = (MarkupString)"This is a test bio";
    string EditClass = "d-none";
    
    public void LoadData(UserDataDto dto)
    {
        userId = dto.Id;
        username = dto.Username;
        BIO = (MarkupString)dto.Bio;
        postCount = dto.PostCount.ToString();
        StateHasChanged();
    }
    
    void EditClickTop()
    {
        EditClass = "d-block";
        message = BIO.ToString();
    }
    string message = "";
    void EditClick()
    {
        _apiLogic.EditBio(userId,message);
        CancelClick();
        _navigationManager.NavigateTo($"/User?userId={userId}",true);
    }
    void CancelClick()
    {
        message = "";
        EditClass = "d-none";
    }
}
<div class="mb-2">
    <div class="d-flex align-items-stretch mb-2"style="outline: 5px solid #171A1D; background-color:#222229">
        <img src =@pfpSource width="128" height="128"/>
        <div class="mx-1">
            <h1>@username</h1>
            <p>@postCount posts</p>
        </div>
        <div class="mt-3 mx-2 text-wrap p-2" style="width:60rem">
            @BIO
        <AuthorizeView>
        @if(Convert.ToInt32(context.User.Identity.GetClaimByName(CustomClaimsTypes.UserId)) == userId ||
            Convert.ToBoolean(context.User.Identity.GetClaimByName(CustomClaimsTypes.Privilege))){
            <div class="mt-5 small" style="cursor:pointer" @onclick="EditClickTop">
                edit
            </div>}
        </AuthorizeView>
        </div>
    </div>
    @* edit field *@
    <AuthorizeView>
        <div class="mt-2 @EditClass">
            <textarea @bind="message" class="bg" rows="5" cols="100" style="color: #d8cfc7;resize: none; background-color: #222229FF !important "></textarea>
            <button @onclick="EditClick" class="btn btn-dark btn-outline-light mx-2">Edit</button>
            <button @onclick="CancelClick" class="btn btn-dark btn-outline-light mx-2">Cancel</button>
        </div>
    </AuthorizeView>
</div>