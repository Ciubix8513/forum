@page "/"
@inject NavigationManager _navigationManager;
@inject IApiLogic _apiLogic;
@using Microsoft.AspNetCore.WebUtilities;
@using Api.Dtos;

@code{
    public int postId  = 1;
    protected override async void OnInitialized()
    {
        var uri = _navigationManager.ToAbsoluteUri(_navigationManager.Uri);
        var qParam = QueryHelpers.ParseQuery(uri.Query).TryGetValue("postId", out var val);
        if(!int.TryParse(val,out postId))
            postId = 1;
        await LoadData();
        base.OnInitialized();
    }
    List<PostsGetDto> data = new();
    TopPost topPost;
    List<Post> posts = new();
    async Task LoadData()
    {
        data = await _apiLogic.GetPosts(postId);
        var Post = await _apiLogic.GetPost(postId);
        topPost.LoadPost(Post);
    }

}
<PageTitle>Index</PageTitle>
<TopPost @ref="topPost"/>
@foreach (var d in data){
    <Post data=@d/>
}